## 一行记录的存储格式
### **数据表的数据存放在哪？**
InnoDB产生的文件有：
- .frm文件：存储表的结构信息（有哪些字段、字段数据类型、字段约束条件、字符集等等）
- .ibd文件：存储表的数据信息
### **InnoDB表空间结构由哪些组成？**
段、区、页、行
![](https://pic.imgdb.cn/item/668a931dd9c307b7e95aeb7c.png)

### InnoDB行格式
InnoDB 提供了 4 种行格式，分别是 Redundant、Compact、Dynamic和 Compressed 行格式。

- Redundant 是很古老的行格式了， MySQL 5.0 版本之前用的行格式，现在基本没人用了。
- 由于 Redundant 不是一种紧凑的行格式，所以 MySQL 5.0 之后引入了 Compact 行记录存储方式，Compact 是一种紧凑的行格式，设计的初衷就是为了让一个数据页中可以存放更多的行记录，从 MySQL 5.1 版本之后，行格式默认设置成 Compact。
- Dynamic 和 Compressed 两个都是紧凑的行格式，它们的行格式都和 Compact 差不多，因为都是基于 Compact 改进一点东西。**从 MySQL5.7 版本之后，默认使用 Dynamic 行格式**。

### **varchar怎么保存长度的？**
在Compact格式中，可通过变长字段长度列表得知变长字段实际占用的数据大小。

**varchar中的n最大取多大呢？**

varchar(n)中的n的单位为字符，最大取值2^16-1=65535字节，但是实际计算的时候还需要把【变长字段长度列表】、【NULL值列表】的长度计算进去。
![](https://pic.imgdb.cn/item/668a93a0d9c307b7e95baa1a.png)
以下为字符集为ASCAII字符集，也就是一个字符占一个字节的情况：
![](https://pic.imgdb.cn/item/668a93d5d9c307b7e95bfa21.png)
其中，变长字段n<=255时，变长字段长度列表为1字节；变长字段n>255时，变长字段长度列表为2字节。
若字段中有NULL值，则NULL值列表为1字节。

### **Null值是如何保存的？**
若所有记录中存在一个NULL值，则存在NULL值列表，其中**按照逆序排列**各个字段是否存在空值，0是不存在空值，1是存在空值。
![](https://pic.imgdb.cn/item/668a9416d9c307b7e95c581e.png)

以上的NULL值列表表示为0x04。

### 为什么「变长字段长度列表」的信息要按照逆序存放？

这个设计是有想法的，主要是因为「记录头信息」中指向下一个记录的指针，指向的是下一条记录的「记录头信息」和「真实数据」之间的位置，这样的好处是**向左读就是记录头信息，向右读就是真实数据，比较方便**。

「变长字段长度列表」中的信息之所以要逆序存放，是因为这样可以**使得位置靠前的记录的真实数据和数据对应的字段长度信息可以同时在一个 CPU Cache Line 中**，这样就可以提高 CPU Cache 的命中率。
> todo:CPU Cache

同样的道理， NULL 值列表的信息也需要逆序存放。